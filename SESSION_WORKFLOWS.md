# セッション作成/編集/日程（Occurrence）運用ガイド

このドキュメントは「セッションを作る」「編集する」「日付（開催日程）を追加する」などの作業パターンをまとめたものです。

## 用語

- **セッション**: `TRPGSession`（従来通り。タイトル/場所/公開設定などの基本情報を持つ）
- **日程（Occurrence）**: `SessionOccurrence`（1セッションに複数作れる開催日程）
- **代表日程（primary）**: `SessionOccurrence.is_primary = true` の日程  
  - 互換性のため `TRPGSession.date` は **代表日程の日時** と同期します（双方向）。

## 作業パターン

### 1) カレンダーから「新規セッション」を作成する

1. `/api/schedules/calendar/view/` を開く
2. 日付をクリックして「新たなる探索の計画」モーダルを開く
3. 「新規セッション」を選択したまま、タイトル/日時/グループ等を入力して保存

- 保存すると、セッション作成と同時に **代表日程（primary occurrence）** が1件作成されます

### 1-b) セッション一覧から「新規セッション」を作成する

1. `/api/schedules/sessions/web/` を開く
2. 「新規セッション」ボタンから作成モーダルを開く
3. タイトル/日時/グループ等を入力して保存

### 2) セッション詳細から「セッション基本情報」を編集する

1. `/api/schedules/sessions/{session_id}/detail/` を開く
2. 「セッション編集」から基本情報を編集して保存

- ここで編集する「日時（代表日時）」は `TRPGSession.date` で、**代表日程（primary）** の日時と同期します

### 3) セッション詳細から「日程（Occurrence）」を追加する（参加者/内容つき）

1. セッション詳細の「開催日程」セクションで「日程を追加」
2. 日時を入力
3. 参加者（任意）をチェック
4. 内容（任意）を入力（空でも保存可）
5. 保存

- **日程の追加/編集はGMのみ** 実行できます
- ここで設定する参加者は「その日程に参加する人」の情報で、日程ごとに変えられます

### 4) セッション詳細から「既存日程（Occurrence）」を編集する

1. 「開催日程」一覧の編集ボタン（鉛筆）を押す
2. 日時/参加者/内容を修正して保存

- **代表日程（primary）** の日時を変更した場合、`TRPGSession.date`（代表日時）も同期して更新されます

### 5) カレンダーから「既存セッションに日程を追加」する（導線）

1. `/api/schedules/calendar/view/` を開く
2. 日付をクリックしてモーダルを開く
3. 「既存セッションに日程を追加」を選択
4. 既存セッションを選択し、日時を入力して「日程を追加」

- カレンダーから追加した日程は、内容が空・参加者未設定の状態で作成されます  
  → 後から「セッション詳細 > 開催日程」で編集して参加者/内容を設定します

### 6) 日程（Occurrence）の削除について

- **primary（日程の代表）は削除できません**
- primary 以外の日程はAPIで削除できます（GMのみ）  
  - `DELETE /api/schedules/occurrences/{occurrence_id}/`
- 現状、セッション詳細UIには削除ボタンはありません（必要なら追加実装）

## 権限/入力ルール（要点）

- 日程（Occurrence）の作成/編集/削除: **GMのみ**
- 日程の参加者: **セッションのグループ所属メンバーのみ**（GMも指定可能）
- 日程の内容: **任意（空OK）**
