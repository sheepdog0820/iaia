{% extends 'base.html' %}
{% load static %}

{% block title %}クトゥルフ神話TRPG 6版探索者作成 - Arkham Nexus{% endblock %}

{% block content %}
<div class="container">
    <!-- ヘッダー -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="eldritch-font">
                        <i class="fas fa-user-ninja text-primary"></i> クトゥルフ神話TRPG 6版探索者作成
                    </h1>
                    <p class="text-muted lead">
                        新たなる探索者を創造し、深淵の謎に立ち向かいましょう。
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- フォーム -->
    <div class="row">
        <div class="col-12">
            <form method="post" id="character-sheet-form" enctype="multipart/form-data">
                {% csrf_token %}
                
                <!-- システム情報フィールド(非表示) -->
                <input type="hidden" id="system" name="system" value="cthulhu_6th">
                <!-- 自動計算されるフィールド(非表示) -->
                <input type="hidden" id="sanity_max" name="sanity_max">
                
                <!-- メインタブナビゲーション -->
                <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="basic-info-tab" data-bs-toggle="tab" data-bs-target="#basic-info" type="button" role="tab">
                            <i class="fas fa-user"></i> 基本情報
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="abilities-tab" data-bs-toggle="tab" data-bs-target="#abilities" type="button" role="tab">
                            <i class="fas fa-dice"></i> 能力値
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="skills-tab" data-bs-toggle="tab" data-bs-target="#skills" type="button" role="tab">
                            <i class="fas fa-graduation-cap"></i> 技能
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="combat-equipment-tab" data-bs-toggle="tab" data-bs-target="#combat-equipment" type="button" role="tab">
                            <i class="fas fa-shield-alt"></i> 戦闘・装備
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="background-tab" data-bs-toggle="tab" data-bs-target="#background" type="button" role="tab">
                            <i class="fas fa-book"></i> 背景情報
                        </button>
                    </li>
                </ul>
                
                <!-- タブコンテンツ -->
                <div class="tab-content" id="mainTabContent">
                    <!-- 基本情報タブ -->
                    <div class="tab-pane fade show active" id="basic-info" role="tabpanel">
                        <!-- 探索者情報 -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-id-card"></i> 探索者情報
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-6 mb-3">
                                <label for="character-name" class="form-label">探索者名 *</label>
                                <input type="text" class="form-control form-control-lg" id="character-name" name="name" 
                                       placeholder="例: 高島 静雄" required>
                            </div>
                            <div class="col-lg-6 mb-3">
                                <label for="player-name" class="form-label">プレイヤー名</label>
                                <input type="text" class="form-control" id="player-name" name="player_name" 
                                       placeholder="あなたの名前">
                            </div>
                            <div class="col-lg-3 mb-3">
                                <label for="age" class="form-label">年齢</label>
                                <input type="number" class="form-control" id="age" name="age" min="15" max="90" placeholder="28">
                            </div>
                            <div class="col-lg-3 mb-3">
                                <label for="gender" class="form-label">性別</label>
                                <select class="form-select" id="gender" name="gender">
                                    <option value="">選択してください</option>
                                    <option value="男性">男性</option>
                                    <option value="女性">女性</option>
                                    <option value="その他">その他</option>
                                </select>
                            </div>
                            <div class="col-lg-3 mb-3">
                                <label for="occupation" class="form-label">職業</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="occupation" name="occupation" 
                                           placeholder="例: 私立探偵">
                                    <button class="btn btn-outline-secondary" type="button" id="occupationTemplateBtn" 
                                            data-bs-toggle="modal" data-bs-target="#occupationTemplateModal">
                                        <i class="fas fa-list"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-lg-3 mb-3">
                                <label for="birthplace" class="form-label">出身地</label>
                                <input type="text" class="form-control" id="birthplace" name="birthplace" 
                                       placeholder="例: 東京">
                            </div>
                            <div class="col-lg-3 mb-3">
                                <label for="residence" class="form-label">現住所</label>
                                <input type="text" class="form-control" id="residence" name="residence" 
                                       placeholder="例: 大阪">
                            </div>
                            <div class="col-12 mb-3">
                                <label for="notes" class="form-label">背景・特徴</label>
                                <textarea class="form-control" id="notes" name="notes" rows="3" 
                                          placeholder="探索者の背景、性格、特徴、動機などを記入してください..."></textarea>
                            </div>
                            <div class="col-12">
                                <label for="character-images" class="form-label">キャラクター画像</label>
                                <div class="row">
                                    <div class="col-md-8">
                                        <input type="file" class="form-control" id="character-images" name="character_images" 
                                               accept="image/jpeg,image/jpg,image/png,image/gif">
                                        <small class="text-muted">対応形式: JPG, PNG, GIF (最大5MB)</small>
                                    </div>
                                    <div class="col-md-4">
                                        <div id="image-preview" class="text-center" style="display: none;">
                                            <img id="preview-img" src="" alt="プレビュー" class="img-fluid rounded" 
                                                 style="max-height: 150px;">
                                            <div class="mt-2">
                                                <button type="button" class="btn btn-sm btn-danger" id="remove-image">
                                                    <i class="fas fa-trash"></i> 削除
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    </div> <!-- 基本情報タブ終了 -->

                    <!-- 能力値タブ -->
                    <div class="tab-pane fade" id="abilities" role="tabpanel">
                        <!-- 全能力値ダイスロール設定 -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h6 class="mb-0">
                                    <i class="fas fa-dice-d20"></i> 全能力値ダイスロール設定
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row align-items-center g-3">
                                    <div class="col-md-2">
                                        <label for="globalDiceCount" class="form-label small">個数</label>
                                        <input type="number" class="form-control" id="globalDiceCount" min="1" max="10" value="3">
                                    </div>
                                    <div class="col-md-2">
                                        <label for="globalDiceSides" class="form-label small">面数</label>
                                        <input type="number" class="form-control" id="globalDiceSides" min="2" max="100" value="6">
                                    </div>
                                    <div class="col-md-2">
                                        <label for="globalDiceBonus" class="form-label small">ボーナス</label>
                                        <input type="number" class="form-control" id="globalDiceBonus" min="-50" max="50" value="0">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small">ダイス式</label>
                                        <div class="text-center p-2 bg-light rounded">
                                            <span id="globalDiceFormula" class="fw-bold text-primary">3d6+0</span>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small">&nbsp;</label>
                                        <div class="d-grid">
                                            <button type="button" class="btn btn-primary" id="rollAllAbilities">
                                                <i class="fas fa-dice-d20"></i> 全能力値ロール
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle"></i> 
                                            全ての基本能力値を一括でダイスロールします。設定したダイス式が全能力値に適用されます。
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 能力別ダイス設定 -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-light">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-cog"></i> 能力別ダイス設定
                                    </h6>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="toggleAbilityDiceSettings">
                                        <i class="fas fa-sliders-h"></i> 表示/非表示
                                    </button>
                                </div>
                            </div>
                            <div class="card-body" id="ability-dice-settings-wrapper" style="display: none;">
                                <div class="row align-items-center g-3 mb-3">
                                    <div class="col-md-4 form-check">
                                        <input class="form-check-input" type="checkbox" id="useAbilityDiceSettings">
                                        <label class="form-check-label" for="useAbilityDiceSettings">能力別設定を使用</label>
                                    </div>
                                    <div class="col-md-4">
                                        <button type="button" class="btn btn-outline-primary w-100" id="copyGlobalDiceSettings">
                                            <i class="fas fa-copy"></i> 全能力値設定をコピー
                                        </button>
                                    </div>
                                    <div class="col-md-4">
                                        <small class="text-muted">各能力ごとに個数/面数/ボーナスを設定できます。</small>
                                    </div>
                                </div>
                                <div class="row" id="ability-dice-settings">
                                    <!-- 能力別ダイス設定がここに動的生成される -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ステータス（能力値と副次ステータス） -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar"></i> ステータス
                        </h5>
                    </div>
                    <div class="card-body">
                        <h6 class="text-primary border-bottom pb-2 mb-3">基本能力値</h6>
                        <!-- 能力値入力エリア -->
                        <div class="row">
                            <div class="col-md-3 col-sm-6 mb-3">
                                <label for="str" class="form-label">STR (筋力)</label>
                                <input type="number" class="form-control ability-score" id="str" name="str_value" min="1" max="999" placeholder="1-999" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary mt-1 ability-roll-btn" data-ability="str">
                                    <i class="fas fa-dice"></i> ロール
                                </button>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <label for="con" class="form-label">CON (体力)</label>
                                <input type="number" class="form-control ability-score" id="con" name="con_value" min="1" max="999" placeholder="1-999" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary mt-1 ability-roll-btn" data-ability="con">
                                    <i class="fas fa-dice"></i> ロール
                                </button>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <label for="pow" class="form-label">POW (精神力)</label>
                                <input type="number" class="form-control ability-score" id="pow" name="pow_value" min="1" max="999" placeholder="1-999" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary mt-1 ability-roll-btn" data-ability="pow">
                                    <i class="fas fa-dice"></i> ロール
                                </button>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <label for="dex" class="form-label">DEX (敏捷性)</label>
                                <input type="number" class="form-control ability-score" id="dex" name="dex_value" min="1" max="999" placeholder="1-999" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary mt-1 ability-roll-btn" data-ability="dex">
                                    <i class="fas fa-dice"></i> ロール
                                </button>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <label for="app" class="form-label">APP (外見)</label>
                                <input type="number" class="form-control ability-score" id="app" name="app_value" min="1" max="999" placeholder="1-999" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary mt-1 ability-roll-btn" data-ability="app">
                                    <i class="fas fa-dice"></i> ロール
                                </button>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <label for="siz" class="form-label">SIZ (体格)</label>
                                <input type="number" class="form-control ability-score" id="siz" name="siz_value" min="1" max="999" placeholder="1-999" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary mt-1 ability-roll-btn" data-ability="siz">
                                    <i class="fas fa-dice"></i> ロール
                                </button>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <label for="int" class="form-label">INT (知性)</label>
                                <input type="number" class="form-control ability-score" id="int" name="int_value" min="1" max="999" placeholder="1-999" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary mt-1 ability-roll-btn" data-ability="int">
                                    <i class="fas fa-dice"></i> ロール
                                </button>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <label for="edu" class="form-label">EDU (教育)</label>
                                <input type="number" class="form-control ability-score" id="edu" name="edu_value" min="1" max="999" placeholder="1-999" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary mt-1 ability-roll-btn" data-ability="edu">
                                    <i class="fas fa-dice"></i> ロール
                                </button>
                            </div>
                        </div>
                        
                        <h6 class="text-info border-bottom pb-2 mb-3 mt-4">副次ステータス（6版ルール）</h6>
                        <div class="row">
                            <div class="col-md-2 col-sm-4 mb-3">
                                <label for="hp" class="form-label">HP (耐久力)</label>
                                <input type="number" class="form-control" id="hp" name="hit_points_max" readonly>
                                <small class="text-muted">(CON+SIZ)/2</small>
                            </div>
                            <div class="col-md-2 col-sm-4 mb-3">
                                <label for="mp" class="form-label">MP</label>
                                <input type="number" class="form-control" id="mp" name="magic_points_max" readonly>
                                <div class="fw-bold text-primary mt-1" id="mp_display">--</div>
                                <small class="text-muted">POW</small>
                            </div>
                            <div class="col-md-2 col-sm-4 mb-3">
                                <label for="san" class="form-label">SAN (正気度)</label>
                                <input type="number" class="form-control" id="san" name="sanity_starting" readonly>
                                <div class="fw-bold text-primary mt-1" id="san_display">--</div>
                                <small class="text-muted">POW×5</small>
                            </div>
                            <div class="col-md-2 col-sm-4 mb-3">
                                <label for="idea" class="form-label">アイデア</label>
                                <input type="number" class="form-control" id="idea" name="idea" readonly>
                                <div class="fw-bold text-primary mt-1" id="idea_display">--</div>
                                <small class="text-muted">INT×5</small>
                            </div>
                            <div class="col-md-2 col-sm-4 mb-3">
                                <label for="luck" class="form-label">幸運</label>
                                <input type="number" class="form-control" id="luck" name="luck" readonly>
                                <div class="fw-bold text-primary mt-1" id="luck_display">--</div>
                                <small class="text-muted">POW×5</small>
                            </div>
                            <div class="col-md-2 col-sm-4 mb-3">
                                <label for="know" class="form-label">知識</label>
                                <input type="number" class="form-control" id="know" name="know" readonly>
                                <div class="fw-bold text-primary mt-1" id="know_display">--</div>
                                <small class="text-muted">EDU×5</small>
                            </div>
                            <div class="col-12 mt-2">
                                <label for="damage-bonus" class="form-label">ダメージボーナス</label>
                                <input type="text" class="form-control" id="damage-bonus" name="damage_bonus" readonly>
                                <div class="fw-bold text-primary mt-1" id="damage_bonus_display">--</div>
                                <small class="text-muted">STR+SIZの合計により決定</small>
                            </div>
                        </div>
                    </div>
                </div>
                    </div> <!-- 能力値タブ終了 -->

                    <!-- 技能タブ -->
                    <div class="tab-pane fade" id="skills" role="tabpanel">
                        <!-- 技能システム -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-tools"></i> 技能システム（6版）
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- ポイント管理 -->
                        <div class="row mb-3 g-3">
                            <div class="col-lg-5">
                                <div class="bg-light p-3 rounded h-100">
                                    <h6 class="text-primary">職業技能ポイント</h6>
                                    <div class="row g-2 mb-2">
                                        <div class="col-12">
                                            <small class="text-muted">計算方式</small>
                                            <select class="form-select form-select-sm" id="occupationMethod">
                                                <option value="edu20">EDU×20</option>
                                                <option value="edu10app10">EDU×10＋APP×10</option>
                                                <option value="edu10dex10">EDU×10＋DEX×10</option>
                                                <option value="edu10pow10">EDU×10＋POW×10</option>
                                                <option value="edu10str10">EDU×10＋STR×10</option>
                                                <option value="edu10con10">EDU×10＋CON×10</option>
                                                <option value="edu10siz10">EDU×10＋SIZ×10</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <small class="text-muted">総ポイント</small>
                                            <input type="number" class="form-control form-control-sm" id="occupationTotal" readonly>
                                        </div>
                                        <div class="col-3">
                                            <small class="text-muted">使用</small>
                                            <div><span id="occupationUsed" class="badge bg-primary fs-6">0</span></div>
                                        </div>
                                        <div class="col-3">
                                            <small class="text-muted">残り</small>
                                            <div><span id="occupationRemaining" class="badge bg-success fs-6">0</span></div>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted">ポイントを割り振ってください</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="bg-light p-3 rounded h-100">
                                    <h6 class="text-info">趣味技能ポイント</h6>
                                    <div class="row g-2 mb-2">
                                        <div class="col-12">
                                            <small class="text-muted">計算方式: <strong>INT×10</strong></small>
                                        </div>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <small class="text-muted">総ポイント</small>
                                            <input type="number" class="form-control form-control-sm" id="interestTotal" readonly>
                                        </div>
                                        <div class="col-3">
                                            <small class="text-muted">使用</small>
                                            <div><span id="interestUsed" class="badge bg-primary fs-6">0</span></div>
                                        </div>
                                        <div class="col-3">
                                            <small class="text-muted">残り</small>
                                            <div><span id="interestRemaining" class="badge bg-success fs-6">0</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="d-grid gap-2 h-100">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="resetSkillPoints">
                                        <i class="fas fa-undo"></i><br><small>リセット</small>
                                    </button>
                                    <button type="button" class="btn btn-primary btn-sm" id="calculateSkills">
                                        <i class="fas fa-calculator"></i><br><small>計算</small>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 技能タブとコンテンツ -->
                        <div id="skillsContainer">
                            <!-- 基本値編集の説明 -->
                            <div class="alert alert-info alert-dismissible fade show mb-3" role="alert">
                                <i class="fas fa-info-circle"></i>
                                <strong>技能の基本値は編集可能です！</strong>
                                <ul class="mb-0 mt-2">
                                    <li>基本値（青色の入力欄）をクリックして、カスタム値を入力できます</li>
                                    <li>右クリックすると、デフォルト値にリセットされます</li>
                                    <li>DEX×2やEDU×5などの動的な基本値も、カスタム値で上書き可能です</li>
                                </ul>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                            
                            <!-- タブナビゲーション -->
                            <ul class="nav nav-tabs" id="skillTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="combat-tab" data-bs-toggle="tab" data-bs-target="#combat" type="button" role="tab">
                                        <i class="fas fa-sword"></i> 戦闘系
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="exploration-tab" data-bs-toggle="tab" data-bs-target="#exploration" type="button" role="tab">
                                        <i class="fas fa-search"></i> 探索技能
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="action-tab" data-bs-toggle="tab" data-bs-target="#action" type="button" role="tab">
                                        <i class="fas fa-running"></i> 行動技能
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="social-tab" data-bs-toggle="tab" data-bs-target="#social" type="button" role="tab">
                                        <i class="fas fa-comments"></i> 交渉技能
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="knowledge-tab" data-bs-toggle="tab" data-bs-target="#knowledge" type="button" role="tab">
                                        <i class="fas fa-book"></i> 知識技能
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab">
                                        <i class="fas fa-list"></i> 全表示
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="allocated-tab" data-bs-toggle="tab" data-bs-target="#allocated" type="button" role="tab">
                                        <i class="fas fa-check-circle"></i> 振り分け済み
                                        <span class="badge bg-success ms-1" id="allocatedCount">0</span>
                                    </button>
                                </li>
                            </ul>
                            
                            <!-- タブコンテンツ -->
                            <div class="tab-content" id="skillTabContent">
                                <!-- 戦闘系技能 -->
                                <div class="tab-pane fade show active" id="combat" role="tabpanel">
                                    <div class="row g-2 mt-2" id="combatSkills">
                                        <!-- 戦闘系技能がここに動的生成される -->
                                    </div>
                                </div>
                                
                                <!-- 探索技能 -->
                                <div class="tab-pane fade" id="exploration" role="tabpanel">
                                    <div class="row g-2 mt-2" id="explorationSkills">
                                        <!-- 探索技能がここに動的生成される -->
                                    </div>
                                </div>
                                
                                <!-- 行動技能 -->
                                <div class="tab-pane fade" id="action" role="tabpanel">
                                    <div class="row g-2 mt-2" id="actionSkills">
                                        <!-- 行動技能がここに動的生成される -->
                                    </div>
                                </div>
                                
                                <!-- 交渉技能 -->
                                <div class="tab-pane fade" id="social" role="tabpanel">
                                    <div class="row g-2 mt-2" id="socialSkills">
                                        <!-- 交渉技能がここに動的生成される -->
                                    </div>
                                </div>
                                
                                <!-- 知識技能 -->
                                <div class="tab-pane fade" id="knowledge" role="tabpanel">
                                    <div class="row g-2 mt-2" id="knowledgeSkills">
                                        <!-- 知識技能がここに動的生成される -->
                                    </div>
                                </div>
                                
                                <!-- 全表示 -->
                                <div class="tab-pane fade" id="all" role="tabpanel">
                                    <div class="row g-2 mt-2" id="allSkills">
                                        <!-- 全技能がここに動的生成される -->
                                    </div>
                                </div>
                                
                                <!-- 振り分け済み -->
                                <div class="tab-pane fade" id="allocated" role="tabpanel">
                                    <div class="row g-2 mt-2" id="allocatedSkills">
                                        <div class="col-12 text-center text-muted p-4" id="noAllocatedMessage">
                                            <i class="fas fa-info-circle fa-2x mb-2"></i>
                                            <p>まだポイントを振り分けた技能がありません。</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    </div> <!-- 技能タブ終了 -->

                    <!-- 戦闘・装備タブ -->
                    <div class="tab-pane fade" id="combat-equipment" role="tabpanel">
                        <!-- 戦闘・装備 -->
                <div class="card mb-4">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-shield-alt"></i> 戦闘・装備
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="current_hp" class="form-label">現在HP</label>
                                <input type="number" class="form-control" id="current_hp" name="hit_points_current"
                                       min="0" max="999" readonly>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="current_mp" class="form-label">現在MP</label>
                                <input type="number" class="form-control" id="current_mp" name="magic_points_current"
                                       min="0" max="999" readonly>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="current_san" class="form-label">現在SAN</label>
                                <input type="number" class="form-control" id="current_san" name="sanity_current"
                                       min="0" max="9999" readonly>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="armor" class="form-label">装甲値</label>
                                <input type="number" class="form-control" id="armor" name="armor" 
                                       min="0" max="50" value="0">
                            </div>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> 武器・防具の詳細は作成後に編集画面で設定できます。
                        </div>
                    </div>
                </div>

                <!-- インベントリ・財産 -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-coins"></i> インベントリ・財産
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="money" class="form-label">所持金</label>
                                <input type="number" class="form-control" id="money" name="money" 
                                       min="0" placeholder="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="assets" class="form-label">総資産</label>
                                <input type="number" class="form-control" id="assets" name="assets" 
                                       min="0" placeholder="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="income" class="form-label">年収</label>
                                <input type="number" class="form-control" id="income" name="income" 
                                       min="0" placeholder="0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <label for="items" class="form-label">所持品メモ</label>
                                <textarea class="form-control" id="items" name="items" rows="3" 
                                          placeholder="主要な所持品を記入してください..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                    </div> <!-- 戦闘・装備タブ終了 -->

                    <!-- 背景情報タブ -->
                    <div class="tab-pane fade" id="background" role="tabpanel">
                        <!-- 背景情報 -->
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-user-clock"></i> 背景情報
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="appearance" class="form-label">外見の描写</label>
                                <textarea class="form-control" id="appearance" name="appearance" rows="2" 
                                          placeholder="身長、体型、髪の色、特徴的な外見など..."></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="ideals" class="form-label">信念・信条</label>
                                <textarea class="form-control" id="ideals" name="ideals" rows="2" 
                                          placeholder="キャラクターが大切にしている価値観や信念..."></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="bonds" class="form-label">重要な人物</label>
                                <textarea class="form-control" id="bonds" name="bonds" rows="2" 
                                          placeholder="家族、友人、恩人など..."></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="flaws" class="form-label">弱点・恐怖症</label>
                                <textarea class="form-control" id="flaws" name="flaws" rows="2" 
                                          placeholder="性格的な弱点、恐怖症、トラウマなど..."></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="backstory" class="form-label">背景ストーリー</label>
                                <textarea class="form-control" id="backstory" name="backstory" rows="4" 
                                          placeholder="探索者の生い立ち、経歴、現在に至るまでの物語..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                    </div> <!-- 背景情報タブ終了 -->
                </div> <!-- タブコンテンツ終了 -->

                <!-- 送信ボタン -->
                <div class="row mb-5">
                    <div class="col-12 text-center">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save"></i> 探索者を作成
                        </button>
                        <button type="button" class="btn btn-outline-primary btn-lg ms-2" id="createVersionButton" style="display: none;">
                            <i class="fas fa-code-branch"></i> 新バージョン作成
                        </button>
                        <a href="/accounts/character/list/" class="btn btn-secondary btn-lg ms-2">
                            <i class="fas fa-times"></i> キャンセル
                        </a>
                    </div>
                </div>

            </form>
        </div>
    </div>
</div>

<!-- 職業テンプレートモーダル -->
<div class="modal fade" id="occupationTemplateModal" tabindex="-1" aria-labelledby="occupationTemplateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="occupationTemplateModalLabel">
                    <i class="fas fa-briefcase"></i> 職業テンプレート選択
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="閉じる"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="list-group" id="occupationCategories">
                            <a href="#" class="list-group-item list-group-item-action active" data-category="academic">
                                <i class="fas fa-graduation-cap"></i> 学術系
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" data-category="investigation">
                                <i class="fas fa-search"></i> 調査系
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" data-category="combat">
                                <i class="fas fa-shield-alt"></i> 戦闘系
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" data-category="medical">
                                <i class="fas fa-heartbeat"></i> 医療系
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" data-category="arts">
                                <i class="fas fa-palette"></i> 芸術系
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" data-category="others">
                                <i class="fas fa-users"></i> その他                            </a>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div id="occupationList">
                            <!-- 職業リストがここに動的生成される -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
            </div>
        </div>
    </div>
</div>

<!-- 固定フッター -->
<div class="character-footer fixed-bottom bg-dark text-light py-3">
    <div class="container">
        <div class="row align-items-center">
            <!-- 職業技能ポイント -->
            <div class="col-md-3">
                <div class="d-flex align-items-center">
                    <span class="me-2">職業技能:</span>
                    <span class="badge bg-success me-1" id="occupationUsedFooter">0</span>
                    <span>/</span>
                    <span class="badge bg-primary ms-1" id="occupationTotalFooter">0</span>
                </div>
            </div>
            
            <!-- 趣味技能ポイント -->
            <div class="col-md-3">
                <div class="d-flex align-items-center">
                    <span class="me-2">趣味技能:</span>
                    <span class="badge bg-warning text-dark me-1" id="interestUsedFooter">0</span>
                    <span>/</span>
                    <span class="badge bg-info ms-1" id="interestTotalFooter">0</span>
                </div>
            </div>
            
            <!-- ダイスボット実行 -->
            <div class="col-md-3">
                <button type="button" class="btn btn-outline-light btn-sm" id="footerRollDice">
                    <i class="fas fa-dice"></i> ダイスロール
                </button>
            </div>
            
            <!-- 探索者保存 -->
            <div class="col-md-3 text-end">
                <button type="button" class="btn btn-outline-primary me-2" id="footerCreateVersion" style="display: none;">
                    <i class="fas fa-code-branch"></i> 新バージョン
                </button>
                <button type="button" class="btn btn-success" id="footerSaveCharacter">
                    <i class="fas fa-save"></i> 探索者保存
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'accounts/css/character6th.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'accounts/js/character6th.js' %}"></script>
{% endblock %}
