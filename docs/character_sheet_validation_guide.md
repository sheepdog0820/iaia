# キャラクターシート表示検証ガイド

## 概要
このガイドでは、キャラクター作成画面でJavaScriptによる値の変更が正しく画面に反映されているかを確認する手順を説明します。

## 検証項目

### 1. 派生ステータスの自動計算
以下の計算が正しく行われているか確認：

#### HP（ヒットポイント）
- **計算式**: `(CON + SIZ) / 2` （端数切り上げ）
- **例**: CON=14, SIZ=13 の場合
  - (14 + 13) / 2 = 13.5
  - Math.ceil(13.5) = **14**

#### MP（マジックポイント）
- **計算式**: `POW`
- **例**: POW=15 の場合、MP=**15**

#### SAN（正気度）
- **初期値**: `POW × 5`
- **最大値**: `99 - クトゥルフ神話技能`
- **例**: POW=15、クトゥルフ神話=0 の場合
  - 初期SAN = 15 × 5 = **75**
  - 最大SAN = 99 - 0 = **99**

#### その他の派生値
- **アイデア**: `INT × 5`
- **幸運**: `POW × 5`
- **知識**: `EDU × 5`

#### ダメージボーナス
STR + SIZ の合計値により決定：
- 2-12: **-1D6**
- 13-16: **-1D4**
- 17-24: **0**
- 25-32: **+1D4**
- 33-40: **+1D6**
- 41以上: さらに増加

### 2. 技能ポイントの計算
- **職業技能ポイント**: `EDU × 20`
- **趣味技能ポイント**: `INT × 10`

### 3. 能力値連動技能
- **回避**: `DEX × 2`
- **母国語**: `EDU × 5`

## 手動検証手順

### ステップ1: 開発サーバーの起動
```bash
python3 manage.py runserver
```

### ステップ2: キャラクター作成画面へアクセス
```
http://localhost:8000/accounts/character/create/6th/
```

### ステップ3: 検証の実施

#### 3.1 初期値の確認
1. ページ読み込み時に、すべての派生ステータスが空または0であることを確認

#### 3.2 能力値入力テスト
1. **STR**に「13」を入力
2. **CON**に「14」を入力
3. **POW**に「15」を入力
4. **DEX**に「12」を入力
5. **APP**に「11」を入力
6. **SIZ**に「13」を入力
7. **INT**に「16」を入力
8. **EDU**に「17」を入力

#### 3.3 自動計算の確認
入力後、以下の値が自動的に表示されることを確認：

| 項目 | 期待値 | 計算式 |
|------|--------|--------|
| HP | 14 | ceil((14+13)/2) |
| MP | 15 | POW |
| 初期SAN | 75 | 15×5 |
| 最大SAN | 99 | 99-0 |
| アイデア | 80 | 16×5 |
| 幸運 | 75 | 15×5 |
| 知識 | 85 | 17×5 |
| ダメージボーナス | +1D4 | STR+SIZ=26 |
| 職業技能ポイント | 340 | 17×20 |
| 趣味技能ポイント | 160 | 16×10 |

### ステップ4: ブラウザ開発者ツールでの確認

1. F12キーで開発者ツールを開く
2. Consoleタブに移動
3. 以下のコマンドを実行して検証：

```javascript
// 手動検証実行
CharacterSheetValidator.runFullValidation();
```

4. エラーがないことを確認

### ステップ5: 動的な変更テスト

#### 5.1 能力値変更
1. **CON**を「10」に変更
2. HPが「12」に自動更新されることを確認（(10+13)/2 = 11.5 → 12）

#### 5.2 クトゥルフ神話技能テスト
1. 技能タブに移動
2. クトゥルフ神話技能に「10」を入力
3. 最大SANが「89」に自動更新されることを確認（99-10）

## 自動検証の活用

開発環境では、`character_sheet_6th_validation.js`が自動的に読み込まれ、以下のタイミングで検証が実行されます：

1. ページ読み込み完了時
2. 能力値変更時

コンソールに検証結果が表示され、不整合があれば赤色のエラーメッセージが表示されます。

## トラブルシューティング

### 値が更新されない場合
1. JavaScriptエラーがないか確認（Console確認）
2. 要素のIDが正しいか確認
3. イベントリスナーが正しく設定されているか確認

### 計算が間違っている場合
1. 計算式が仕様通りか確認
2. 端数処理（切り上げ/切り捨て）が正しいか確認
3. 入力値の型変換が正しく行われているか確認

## まとめ

この検証により、以下が保証されます：
- JavaScriptの計算ロジックが正しい
- 画面表示が計算結果と一致している
- ユーザーが見ている値と内部の値に相違がない