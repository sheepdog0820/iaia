# 技能タブ機能仕様書

## 概要
クトゥルフ神話TRPG 6版キャラクター作成画面における技能表示・管理のタブ切り替え機能の仕様です。

## 機能要件

### 1. タブ構成

#### 1.1 基本タブ（左から右の順序）
| タブ名 | 説明 | アイコン | 表示内容 |
|--------|------|----------|----------|
| ポイント割り振り | ポイントを割り振った技能のみ表示 | fas fa-chart-bar | 職業・趣味技能ポイントが1以上の技能（3列レイアウト） |
| 全て | 全ての技能を表示 | fas fa-list | 生成された全技能（3列レイアウト） |
| 戦闘 | 戦闘関連技能のみ表示 | fas fa-sword | 戦闘カテゴリの技能（3列レイアウト） |
| 探索 | 探索関連技能のみ表示 | fas fa-search | 探索カテゴリの技能（3列レイアウト） |
| 行動 | 行動関連技能のみ表示 | fas fa-running | 行動カテゴリの技能（3列レイアウト） |
| 交渉 | 交渉関連技能のみ表示 | fas fa-comments | 交渉カテゴリの技能（3列レイアウト） |
| 知識 | 知識関連技能のみ表示 | fas fa-brain | 知識カテゴリの技能（3列レイアウト） |

#### 1.2 技能分類定義

**戦闘技能**
- 回避、応急手当、投擲
- 拳銃、ライフル、ショットガン、サブマシンガン、マシンガン
- 格闘、ナイフ、剣、手斧、むち、スピア、弓

**探索技能**
- 応急手当、鍵開け、隠す、隠れる、聞き耳、忍び歩き
- 写真術、精神分析、追跡、登攀、図書館、目星

**行動技能**
- 運転（自動車）、運転（その他）、機械修理、重機械操作
- 乗馬、水泳、跳躍、電気修理、ナビゲート、変装

**交渉技能**
- 言いくるめ、信用、説得、値切り、心理学、母国語

**知識技能**
- 医学、オカルト、化学、クトゥルフ神話、芸術、経理
- 考古学、コンピューター、人類学、生物学、地質学
- 電子工学、天文学、博物学、物理学、法律、薬学
- 歴史、他の言語

### 2. 表示仕様

#### 2.1 レイアウト
- **3列表示**: 全てのタブで技能は3列（col-12 col-md-6 col-lg-4）に整頓して表示
- **レスポンシブ**: 小画面では1列、中画面では2列、大画面では3列
- **統一デザイン**: 全タブで一貫したカード型技能表示

#### 2.2 技能カード構成
各技能は以下の入力フィールドを含む：
- **初期値**: 技能の基本値（自動計算）
- **職業**: 職業技能ポイント割り振り入力
- **趣味**: 趣味技能ポイント割り振り入力  
- **ボーナス**: ボーナスポイント入力
- **合計**: 上記の合計値（自動計算）

#### 2.3 タブバッジ
各タブ名の右側に表示技能数をバッジで表示
- 動的更新: タブ切り替え・ポイント割り振り時に自動更新
- 色: bg-secondary（グレー）

### 3. 動作仕様

#### 3.1 初期化処理
1. 技能リスト生成後に `initializeSkillTabs()` を実行
2. 全ての技能を `all-skills-container` に生成
3. 各カテゴリのコンテナに技能を分類・複製して配置
4. タブバッジの初期設定

#### 3.2 タブ切り替え処理
1. Bootstrap 5の `shown.bs.tab` イベントを使用
2. 選択されたタブに応じて `populateSkillCategory(category)` を実行
3. 該当カテゴリの技能のみを表示コンテナに再配置

#### 3.3 リアルタイム更新
- **ポイント割り振り時**: `updateSkillPointsUsage()` 関数でリアルタイム更新
- **現在アクティブなタブを再描画**: ポイント割り振り状況を即座に反映
- **バッジ更新**: 該当タブの技能数を動的更新

### 4. JavaScript API

#### 4.1 主要関数

**initializeSkillTabs()**
- 技能タブシステムの初期化
- 技能分類とカテゴリ別配置を実行

**populateSkillCategory(targetCategory)**
- 指定カテゴリの技能を該当タブコンテナに配置
- 3列レイアウトを維持
- タブバッジを更新

**updateSkillPointsUsage()**
- 技能ポイント使用量の計算・表示更新
- ポイント割り振りタブの動的更新
- プログレスバーの更新

#### 4.2 イベントハンドラ
- **タブ切り替え**: Bootstrap 5 `shown.bs.tab` イベント
- **ポイント変更**: 技能入力フィールドの `onchange` イベント

### 5. 技術仕様

#### 5.1 HTML構造
```html
<!-- タブナビゲーション -->
<ul class="nav nav-pills nav-fill mb-3" id="skillTabs" role="tablist">
  <!-- 各タブボタン -->
</ul>

<!-- タブコンテンツ -->
<div class="tab-content" id="skillTabContent">
  <!-- 各カテゴリのタブペイン -->
  <div class="tab-pane fade" id="category-skills">
    <div id="category-skills-container">
      <!-- 3列レイアウトで技能表示 -->
    </div>
  </div>
</div>
```

#### 5.2 CSS クラス
- `.skill-item-wrapper`: 技能アイテム全体のコンテナ
- `.skill-title`: 技能名表示要素
- `.skill-occupation`: 職業技能ポイント入力
- `.skill-interest`: 趣味技能ポイント入力

#### 5.3 データ属性
- `data-skill-tab`: タブボタンのカテゴリ識別子
- `data-skill-name`: 技能名（小文字）
- `data-skill-category`: 技能カテゴリ

### 6. パフォーマンス考慮事項

#### 6.1 最適化施策
- **技能複製**: DOM要素のcloneNode(true)を使用
- **遅延初期化**: setTimeout(100ms)での初期化
- **差分更新**: アクティブタブのみ再描画

#### 6.2 制限事項
- 技能数上限: 100技能まで想定
- 同時表示カテゴリ: 1つのみ（排他的表示）

### 7. 今後の拡張予定

#### 7.1 フィルタリング機能
- 技能名検索
- ポイント範囲フィルタ
- カスタム技能フィルタ

#### 7.2 ソート機能
- 技能名順
- ポイント順
- 使用頻度順

## 関連ファイル

- **メインテンプレート**: `templates/accounts/character_sheet_6th.html`
- **JavaScript**: テンプレート内の `<script>` セクション
- **CSS**: テンプレート内の `<style>` セクション

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|------------|----------|
| 2025-06-22 | 1.0.0 | 初版作成・技能タブ機能実装 |
| 2025-06-22 | 1.1.0 | タブ順序変更（ポイント割り振りを最左）、行動技能タブ追加、その他タブ削除 |

## 承認

| 役職 | 氏名 | 日付 | 署名 |
|------|------|------|------|
| 開発者 | Claude | 2025-06-22 | ✅ |