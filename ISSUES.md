# 🎯 Arkham Nexus - 課題管理チケット

## 📋 概要
統合テスト実施により判明した課題と今後の実装タスクを管理します。

**注意**: 完了済み課題は`ISSUES_CLOSED.md`に移動されています。

---

## 🔴 優先度: 高

### ISSUE-009: セッション機能の統合テスト失敗修正
- **カテゴリ**: バグ修正
- **影響範囲**: セッション機能、キャラクター管理
- **詳細**:
  - セッション統合テストで多数の失敗が発生
  - CharacterSheetモデルにリアルタイムステータス属性が不足
  - APIエンドポイントの不具合
- **該当ファイル**:
  - `accounts/character_models.py` - hp_current, mp_current, san_current 追加
  - `accounts/views/mixins.py` - character_sheet_id 処理修正
  - `accounts/test_session_integration.py` - テストケース
- **実装内容**:
  - ✅ **リアルタイムステータス属性追加** - hp_current, mp_current, san_current（プロパティエイリアスで実装済み）
  - ✅ **character_sheet_id 取得ロジック修正** - IDから直接取得（リクエストデータからも取得可能）
  - ❌ **クロス参加権限管理** - 権限チェック実装
  - ❌ **複数GM協力セッション** - 複数GM対応
  - ❌ **統計更新機能** - セッション完了時の統計処理
- **テスト結果**:
  - accounts.test_session_integration: 16テスト中12テスト失敗
  - schedules.test_session_integration: 4テスト中1テスト失敗
  - test_character_session_integration: 4テスト中2テスト失敗
- **更新日**: 2025年6月24日

### ISSUE-004: クトゥルフ神話TRPG 6版キャラクターシート機能強化
- **カテゴリ**: 新機能実装
- **影響範囲**: キャラクターシート機能
- **詳細**:
  - `CHARACTER_SHEET_COC6TH.md`仕様書に基づく機能拡張
  - 現在基本的なキャラクター作成は実装済み、詳細機能が未実装
- **該当ファイル**:
  - `accounts/character_models.py` - CharacterSheet, CharacterSkill, CharacterEquipment
  - `templates/accounts/character_sheet_6th.html` - 6版作成画面
  - `accounts/views/character_views.py` - CharacterSheetViewSet
- **実装内容**:
  - ✅ **基本キャラクター作成機能** - 実装済み
  - ✅ **CCFOLIA連携機能** - 実装済み（export_ccfolia_format）
  - ✅ **カスタム技能追加機能** - 実装済み（create_custom_skill）
  - ✅ **ダイスロール設定機能** - 実装済み（CharacterDiceRollSetting）
  - ✅ **バージョン管理機能** - 実装済み（CharacterVersionManager）
  - ✅ **職業テンプレート機能** - 部分実装（apply_occupation_template）
  - ✅ **技能ポイント管理システム** - 実装完了（2025年6月20日）
  - ✅ **戦闘データ管理** - 実装完了（2025年6月20日）
  - ✅ **所持品・装備管理** - 実装完了（2025年6月20日）
  - ✅ **背景情報詳細化** - 実装完了（2025年6月20日）
  - ❌ **成長記録システム** - モデル実装済み、UI未実装
- **更新日**: 2025年6月19日

### ISSUE-005: Tindalos統計APIの詳細実装
- **カテゴリ**: 機能強化
- **影響範囲**: 統計機能
- **詳細**:
  - `/api/accounts/statistics/tindalos/` - Tindalos指標API
  - 現在基本実装済み、詳細機能の追加が必要
- **該当ファイル**:
  - `accounts/statistics_views.py` - SimpleTindalosMetricsView実装済み
- **実装内容**:
  - ✅ **基本統計機能** - 実装済み
  - ✅ **年度・月別詳細集計** - 実装完了（2025年6月20日）
  - ✅ **ゲームシステム別統計** - 実装完了（2025年6月20日）
  - ✅ **期間指定フィルタ** - 実装完了（2025年6月20日）

---

## 🟡 優先度: 中

### ISSUE-006: グループ統計APIの詳細実装
- **カテゴリ**: 機能強化
- **影響範囲**: グループ管理機能
- **詳細**:
  - `/api/accounts/statistics/groups/` - グループ統計API
  - 現在基本実装済み、詳細機能の追加が必要
- **該当ファイル**:
  - `accounts/statistics_views.py` - GroupStatisticsView実装済み
- **実装内容**:
  - ✅ **基本グループ統計** - 実装済み
  - ❌ **グループ活動サマリー詳細** - 未実装
  - ❌ **メンバー参加率分析** - 未実装
  - ❌ **人気シナリオランキング** - 未実装

### ISSUE-007: ユーザーランキングAPIの詳細実装
- **カテゴリ**: 機能強化
- **影響範囲**: 統計機能
- **詳細**:
  - `/api/accounts/statistics/ranking/` - ユーザーランキングAPI
  - 現在基本実装済み、詳細機能の追加が必要
- **該当ファイル**:
  - `accounts/statistics_views.py` - UserRankingView実装済み
- **実装内容**:
  - ✅ **基本ランキング機能** - 実装済み
  - ❌ **期間別ランキング** - 未実装
  - ❌ **カテゴリ別ランキング** - 未実装
  - ❌ **ランキング推移** - 未実装

### ISSUE-008: カレンダー統合APIの実装
- **カテゴリ**: 新機能実装
- **影響範囲**: スケジュール管理機能
- **詳細**:
  - `/api/schedules/calendar/view/` - カレンダービューAPI
  - 現在Web画面は実装済み、API機能が未実装
- **該当ファイル**:
  - `schedules/views.py` - Web画面実装済み
- **実装内容**:
  - ✅ **カレンダーWeb画面** - 実装済み
  - ✅ **月別イベント一覧API** - 実装完了（2025年6月20日）
  - ✅ **セッション予定集約API** - 実装完了（2025年6月20日）
  - ✅ **iCal形式エクスポート** - 実装完了（2025年6月20日）
- **実装詳細**:
  - MonthlyEventListView: 月別イベントを日付別にグループ化して返すAPI
  - SessionAggregationView: セッションをグループ別、週別、役割別に集約
  - ICalExportView: iCal形式でセッションをエクスポート（リマインダー付き）
- **更新日**: 2025年6月20日


### ISSUE-014: セッションノート・ログシステム
- **カテゴリ**: 新機能実装
- **影響範囲**: セッション管理機能
- **詳細**:
  - セッション終了後の記録管理機能
  - GMプライベートノート、公開サマリー、プレイログの実装
- **該当ファイル**:
  - `schedules/models.py` - SessionNote, SessionLogモデル追加必要
  - `schedules/views.py` - ノート管理APIの実装
  - `templates/schedules/session_detail.html` - UI実装
- **実装内容**:
  - ❌ **SessionNoteモデル** - 未実装
  - ❌ **GMプライベートノート機能** - 未実装
  - ❌ **セッションサマリー機能** - 未実装
  - ❌ **プレイログ時系列記録** - 未実装
  - ❌ **NPCメモ管理** - 未実装
- **優先理由**: TRPGプレイヤーから最も要望が多い機能

### ISSUE-015: キャラクターシートセッション統合
- **カテゴリ**: 機能統合
- **影響範囲**: セッション管理・キャラクター管理
- **詳細**:
  - セッション中のキャラクター状態管理
  - HP/MP/SAN値のリアルタイム追跡
- **該当ファイル**:
  - `schedules/models.py` - SessionCharacterStatusモデル追加
  - `schedules/views.py` - キャラクター状態管理API
  - `templates/schedules/session_play.html` - プレイ画面UI
- **実装内容**:
  - ❌ **SessionCharacterStatusモデル** - 未実装
  - ❌ **HP/MP/SANトラッキング** - 未実装
  - ❌ **セッション開始時スナップショット** - 未実装
  - ❌ **セッション終了時の変更履歴** - 未実装
  - ❌ **ステータスエフェクト管理** - 未実装

### ISSUE-016: セッション素材管理システム
- **カテゴリ**: 新機能実装
- **影響範囲**: セッション管理機能
- **詳細**:
  - マップ、音楽、画像などのセッション素材を一元管理
  - 外部サービスリンク集約
- **該当ファイル**:
  - `schedules/models.py` - SessionResourceモデル追加
  - `schedules/views.py` - 素材管理API
  - `templates/schedules/session_resources.html` - 素材管理UI
- **実装内容**:
  - ❌ **SessionResourceモデル** - 未実装
  - ✅ **画像アップロード機能** - 実装済み（SessionImage）
  - ❌ **音楽ファイル管理** - 未実装
  - ❌ **外部URL管理機能** - 未実装
  - ❌ **素材カテゴリ分類** - 未実装
  - ❌ **素材プレビュー機能** - 未実装
- **更新日**: 2025年6月25日

---

## 🟢 優先度: 低

### ISSUE-010: テストカバレッジの向上
- **カテゴリ**: テスト改善
- **影響範囲**: 全体
- **詳細**:
  - 現在基本テストは実装済み、詳細テストの追加が必要
- **該当ファイル**:
  - 各種テストファイル (test_*.py)
- **実装内容**:
  - ✅ **基本機能テスト** - 実装済み
  - ✅ **統合テスト** - 実装済み (100%成功率)
  - ❌ **境界値テスト** - 未実装
  - ❌ **エラーケーステスト強化** - 未実装
  - ❌ **パフォーマンステスト** - 未実装

### ISSUE-011: APIドキュメント自動生成
- **カテゴリ**: ドキュメント
- **影響範囲**: API全般
- **詳細**:
  - OpenAPI/Swagger対応でAPI仕様書の自動生成
- **実装内容**:
  - ❌ **drf-spectacular導入** - 未実装
  - ❌ **エンドポイント説明追加** - 未実装
  - ❌ **スキーマ生成設定** - 未実装

### ISSUE-012: 非同期処理の導入検討
- **カテゴリ**: パフォーマンス改善
- **影響範囲**: 統計処理、エクスポート機能
- **詳細**:
  - 重い統計処理やエクスポート処理の非同期化
- **実装内容**:
  - ❌ **Celery導入** - 未実装
  - ❌ **バックグラウンドタスク** - 未実装
  - ❌ **進捗表示機能** - 未実装

### ISSUE-017: 高度なスケジューリング機能
- **カテゴリ**: 新機能実装
- **影響範囲**: スケジュール管理機能
- **詳細**:
  - 定期セッション設定、キャンペーン管理

### ISSUE-018: セッションYouTubeリンク機能
- **カテゴリ**: 新機能追加
- **影響範囲**: セッション管理
- **詳細**:
  - 複数のYouTube動画をセッションにリンク
  - 動画情報の自動取得（タイトル、再生時間、サムネイル）
  - 各動画への備考追加機能
- **実装内容**:
  - ✅ **仕様書作成** - 完了（SESSION_YOUTUBE_LINKS_SPECIFICATION.md）
  - ❌ **データモデル実装** - 未実装（SessionYouTubeLink）
  - ❌ **YouTube API連携** - 未実装
  - ❌ **CRUD API実装** - 未実装
  - ❌ **UI実装** - 未実装
- **作成日**: 2025年6月25日
  - 参加可能日投票、タイムゾーン対応
- **該当ファイル**:
  - `schedules/models.py` - SessionSeries, SessionAvailabilityモデル追加
  - `schedules/views.py` - 定期セッション管理API
  - `templates/schedules/recurring_session.html` - 定期セッション設定UI
- **実装内容**:
  - ❌ **SessionSeriesモデル** - 未実装
  - ❌ **定期セッション自動作成** - 未実装
  - ❌ **参加可能日投票機能** - 未実装
  - ❌ **タイムゾーン変換対応** - 未実装
  - ❌ **キャンペーン連続セッション管理** - 未実装

### ISSUE-018: セッション準備・事後処理ツール
- **カテゴリ**: 新機能実装
- **影響範囲**: セッション管理機能
- **詳細**:
  - GM向けセッション準備支援
  - セッション後のフィードバック、XP配布機能
- **該当ファイル**:
  - `schedules/models.py` - SessionPreparation, SessionFeedbackモデル
  - `schedules/views.py` - 準備・フィードバックAPI
  - `templates/schedules/session_preparation.html` - 準備画面UI
- **実装内容**:
  - ❌ **準備チェックリスト機能** - 未実装
  - ❌ **セッションテンプレート** - 未実装
  - ❌ **フィードバックシステム** - 未実装
  - ❌ **経験値配布機能** - 未実装
  - ❌ **アイテム・報酬管理** - 未実装

### ISSUE-019: セッション分析ダッシュボード
- **カテゴリ**: 新機能実装
- **影響範囲**: 統計・分析機能
- **詳細**:
  - セッションデータの統計分析とビジュアライゼーション
  - 参加率、人気時間帯、GM負荷分析
- **該当ファイル**:
  - `schedules/analytics_views.py` - 分析API（新規作成）
  - `templates/schedules/analytics_dashboard.html` - ダッシュボードUI
- **実装内容**:
  - ❌ **参加率分析機能** - 未実装
  - ❌ **人気時間帯分析** - 未実装
  - ❌ **セッション時間推移グラフ** - 未実装
  - ❌ **GM負荷分析** - 未実装
  - ❌ **プレイヤー相性分析** - 未実装

### ISSUE-013: 通知機能の拡張
- **カテゴリ**: 新機能実装
- **影響範囲**: 全体
- **詳細**:
  - 現在ハンドアウト通知機能は実装済み、他の通知機能の追加が必要
- **該当ファイル**:
  - `schedules/notification_views.py` - 基本実装済み
  - `schedules/models.py` - UserNotificationPreferences実装済み
- **実装内容**:
  - ✅ **ハンドアウト通知** - 実装済み
  - ✅ **セッション招待通知** - 実装完了（2025年6月20日）
  - ✅ **スケジュール変更通知** - 実装完了（2025年6月20日）
  - ❌ **フレンドリクエスト通知** - 未実装
  - ❌ **リアルタイム通知** - 未実装
- **実装詳細**:
  - SessionNotificationService: セッション関連通知サービスクラス追加
  - セッション招待、スケジュール変更、キャンセル、リマインダー通知実装
  - HandoutNotificationモデルを拡張（新しい通知タイプとmetadataフィールド）
  - TRPGSessionViewSetにinviteアクションと自動通知機能追加
- **更新日**: 2025年6月20日

---

## 📊 進捗管理

### 統合テスト結果サマリー (2025年6月18日最新)
- **総テストスイート数**: 16
- **成功**: 16 (100.0%)
- **失敗**: 0 (0.0%)
- **CCFOLIA専用テスト**: 28件全て成功

### 主要機能の動作確認状況
- ✅ ユーザー認証・権限管理
- ✅ セッション管理・参加者管理
- ✅ シナリオ管理・プレイ履歴
- ✅ グループ管理（プライベート・パブリック両対応）
- ✅ デモログイン機能
- ✅ APIエラーハンドリング
- ✅ ハンドアウト一括管理機能
- ✅ 統計・エクスポート機能（新仕様）
- ✅ CCFOLIA連携機能（完全実装）
- ✅ クトゥルフ神話TRPG 6版キャラクターシート（基本機能）
- ✅ 通知機能（ハンドアウト、セッション招待、スケジュール変更）
- ✅ カレンダー統合API（月別イベント、集約、iCal形式）
- ❌ 詳細統計機能（Tindalos拡張）

### 実装完了率
- **高優先度**: 2/2 (100%) - 残り2件が現在進行中
- **中優先度**: 1/7 (14%) - ISSUE-008完了、6件未着手
- **低優先度**: 1/7 (14%) - ISSUE-013部分完了、6件未着手

### 完了済み課題
- **アーカイブ済み**: 4件 - `ISSUES_CLOSED.md`参照
- **完了期間**: 2024年6月14日〜2025年6月18日

---

## 🚀 次のステップ

### 現在の最優先課題
1. **ISSUE-004** クトゥルフ神話TRPG 6版キャラクターシート機能強化 - **🎯 最優先**
2. **ISSUE-005** Tindalos統計APIの詳細実装

### 次期実装優先順位  
3. **ISSUE-014** セッションノート・ログシステム - **推奨**
4. **ISSUE-015** キャラクターシートセッション統合
5. **ISSUE-016** セッション素材管理システム
6. **ISSUE-006** グループ統計APIの詳細実装
7. **ISSUE-007** ユーザーランキングAPIの詳細実装

### アーカイブ済み（完了）
- **ISSUE-001** パブリックグループ修正 → `ISSUES_CLOSED.md`
- **ISSUE-002** エクスポート機能API → `ISSUES_CLOSED.md`  
- **ISSUE-003** CCFOLIA連携機能 → `ISSUES_CLOSED.md`
- **ISSUE-009** ハンドアウト一括管理 → `ISSUES_CLOSED.md`

### 品質保証
- 各機能実装後は必ず統合テストを実行して動作確認
- **統合テスト成功率100%の維持**
- CCFOLIA連携機能のテストも継続実行